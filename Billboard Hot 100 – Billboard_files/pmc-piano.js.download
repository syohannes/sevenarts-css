var pmcPiano;(()=>{var e={13:function(e,n,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e},o.apply(this,arguments)},i=this&&this.__createBinding||(Object.create?function(e,n,t,o){void 0===o&&(o=t);var i=Object.getOwnPropertyDescriptor(n,t);i&&!("get"in i?!n.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return n[t]}}),Object.defineProperty(e,o,i)}:function(e,n,t,o){void 0===o&&(o=t),e[o]=n[t]}),r=this&&this.__setModuleDefault||(Object.create?function(e,n){Object.defineProperty(e,"default",{enumerable:!0,value:n})}:function(e,n){e.default=n}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var t in e)"default"!==t&&Object.prototype.hasOwnProperty.call(e,t)&&i(n,e,t);return r(n,e),n},a=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))((function(i,r){function s(e){try{c(o.next(e))}catch(e){r(e)}}function a(e){try{c(o.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}c((o=o.apply(e,n||[])).next())}))},c=this&&this.__generator||function(e,n){var t,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=n.call(e,s)}catch(e){r=[6,e],o=0}finally{t=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},l=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var o,i=0,r=n.length;i<r;i++)!o&&i in n||(o||(o=Array.prototype.slice.call(n,0,i)),o[i]=n[i]);return e.concat(o||Array.prototype.slice.call(n))},u={initialized:!1,scriptUrl:window.pmcPianoData.scriptUrl,isIPUser:!1,isProd:window.pmcPianoData.isProd,canDebug:window.pmcPianoData.canDebug,userCustomFieldsEndpoint:"/wp-json/pmc/piano/v1/user/custom-fields",licenseeEndpoint:"/wp-json/pmc/piano/v1/licensee",user:null,reporting:{entitlements:"",user_type:"ANONYMOUS",acct_id:null,acct_type:null,org_id:null,org_name:null,paywall_logged_in:!1},onLoggedInUserCallbacks:[],onLoggedOutUserCallbacks:[],onPageLoadNotHasUserCallbacks:[],onHasIPUserCallbacks:[],myAccountPageSelector:".js-subscription-my-account-component",passwordResetPageSelector:".js-subscription-password-reset-component",pianoPaywallSelector:"#piano-paywall",pmcPaywallSelector:".pmc-paywall",truncatedContentSelector:"a-article-cropped",checkTp:function(){window.tp&&!Array.isArray(window.tp)&&window.tp.pianoId?this.tpLoaded():setTimeout(this.checkTp.bind(this),500)},tpLoaded:function(){var e=u;window.tp&&window.tp.push(["init",e.initialize.bind(e)])},initialize:function(){var e=this,n=window.tp;u.isProd||(n.push(["setSandbox",!0]),n.push(["setPianoIdUrl","https://sandbox.tinypass.com"])),u.canDebug&&n.push(["setDebug",!0]),n.push(["setUsePianoIdUserProvider",!0]),n.push(["addHandler","loginSuccess",function(n){e.canDebug&&console.log("PMC: Piano: loginSuccess",n),e.setUserData.apply(e)}]),n.push(["addHandler","checkoutComplete",function(){/reader_id=amp/gi.exec(window.location.search)&&window.close()}]),window.onmessage=e.registrationSuccess,e.setUserData.apply(e),e.registerOnPageLoadNotHasUserCallback(e.maybeRenderMyAccountPage.bind(this)),e.registerOnLoggedInUserCallback(e.maybeRenderMyAccountPage.bind(this)),e.registerOnLoggedOutUserCallback(e.maybeRenderMyAccountPage.bind(this)),e.registerOnLoggedInUserCallback(e.reRenderExperiences.bind(this)),e.registerOnLoggedOutUserCallback(e.reRenderExperiences.bind(this)),e.maybeRenderPasswordResetPage(),e.registerOnLoggedInUserCallback(e.setReportingForAuthUser.bind(this)),e.registerOnLoggedInUserCallback(e.setAuthenticatedUserId.bind(this)),e.registerOnLoggedOutUserCallback(e.deleteReportingCookie.bind(this))},setAuthenticatedUserId:function(){var e=u,n=window.blogherads||{},t=e.getUser().uid;e.canDebug&&console.log("PMC: Piano: setAuthenticatedUserId",t),n.adq=n.adq||[],n.adq.push((function(){try{n.setAuthenticatedUserId(t,"piano")}catch(e){}}))},registrationSuccess:function(e){var n=u;if("string"==typeof e.data){var t=void 0;try{t=JSON.parse(e.data)}catch(e){return n.canDebug&&console.warn("PMC: Piano: registration",e),!1}t.sender&&t.sender.startsWith("piano-id")&&"registrationSuccess"===t.event&&(n.canDebug&&console.log("PMC: Piano: registrationSuccess",e),n.onLoggedInUserCallbacks=n.onLoggedInUserCallbacks.filter((function(e){return"bound reRenderExperiences"!==e.name})))}return!0},login:function(e){e.preventDefault(),window.tp.pianoId.show({screen:"login"})},logout:function(e){e.preventDefault(),window.tp.pianoId.logout(u.onLogout)},onLogout:function(){u.canDebug&&console.log("PMC: Piano: User logged-out",u.user),u.user=null,u.triggerOnLoggedOutUserCallbacks()},hasUser:function(){return!!this.user},hasIPUser:function(){return!!this.isIPUser},getUser:function(){return this.user},setUserData:function(){var e=this,n=window.tp;n.user.isUserValid()?n.pianoId.getUser()&&(e.initialized=!0,e.user=n.pianoId.getUser(),e.canDebug&&console.log("PMC: Piano: User logged-in",e.user),e.triggerOnLoggedInUserCallbacks()):(e.canDebug&&console.log("PMC: Piano: Page load, no user"),e.initialized=!0,e.user=null,e.setReportingCookie(),e.triggerOnPageLoadNotHasUserCallbacks())},registerStickyFooter:function(e){var n=window.pmcPiano.piano;n.registerOnPageLoadNotHasUserCallback(function(){var t=document.querySelector(e.className||".js-subscription-sticky-footer");if(t){var o=document.getElementsByClassName(e.targetClassName||"footer"),i=function(){var e=function(){var e=window.scrollY,n=window.innerHeight,i=o[0].offsetTop;return e+n+("static"===t.style.position?t.clientHeight:0)>i};setTimeout(function(){this.stickyFooterPrevTime=this.stickyFooterPrevTime||Date.now(),this.stickyFooterPrevTime&&500>Date.now()-this.stickyFooterPrevTime||(this.stickyFooterPrevTime=Date.now(),e()||"fixed"===t.style.position?e()&&"static"!==t.style.position&&(t.style.position="static"):(t.style.position="fixed",t.style.bottom="0px"))}.bind(n),500)};i(),window.addEventListener("load",i),window.addEventListener("scroll",i),window.addEventListener("resize",i)}}.bind(n))},tpCallApiPromise:function(e,n){return void 0===n&&(n={}),new Promise((function(t){window.tp.api.callApi(e,n,t)}))},getReportingForAuthUser:function(){var e,n,t,o,i,r;return a(this,void 0,void 0,(function(){var s,a,u,d,g,p,h,f,v,m,b,w,P,y,C,U=this;return c(this,(function(c){switch(c.label){case 0:return[4,this.tpCallApiPromise("/conversion/list")];case 1:s=null!==(n=null===(e=c.sent())||void 0===e?void 0:e.conversions)&&void 0!==n?n:[],a=null!==(t=s.sort((function(e,n){return n.create_date-e.create_date}))[0])&&void 0!==t?t:void 0,s=s.filter((function(e){var n;return null===(n=null==e?void 0:e.user_access)||void 0===n?void 0:n.granted})),s=0>=s.length?[a]:function(e){var n=[];return 1>=e.length?e:(["( |^)corporate","( |^)education","( |^)partner","( |^)billboard member","( |^)(comp|employee)","( |^)(limited|registration)"].forEach((function(t){for(var o,i,r,s=0;s<e.length;s++){var a=e[s];(null===(r=null===(i=null===(o=null==a?void 0:a.term)||void 0===o?void 0:o.resource)||void 0===i?void 0:i.name)||void 0===r?void 0:r.match(new RegExp(t,"i")))&&(n=l(l([],n,!0),[a],!1),e.splice(s,1),s--)}})),0<e.length&&(n=l(l([],e,!0),n,!0)),n)}(l([],s,!0)),u=function(e){return e&&("email_domain_contract"===(null==e?void 0:e.type)||"specific_email_addresses_contract"===(null==e?void 0:e.type))},d=Array.from(new Set(s.map((function(e){var n;return null===(n=null==e?void 0:e.term)||void 0===n?void 0:n.resource.name})))).join("|")||void 0,g=Array.from(new Set(s.map((function(e){var n;return null===(n=null==e?void 0:e.term)||void 0===n?void 0:n.name})))).join("|")||void 0,p=Array.from(new Set(s.map((function(e){return u(null==e?void 0:e.term)?"site_license":"individual"})))).sort((function(e,n){return e.localeCompare(n)})).join("|")||"individual",h=Array.from(new Set(s.map((function(e){return(null==e?void 0:e.user_access)||(null==e?void 0:e.term)?U.getAuthUserType(e):void 0})))).sort((function(e,n){return e.localeCompare(n)})).join("|")||void 0,f=[],v=0,m=s,c.label=2;case 2:return v<m.length?(b=m[v],(null===(o=null==b?void 0:b.term)||void 0===o?void 0:o.term_id)&&u(null==b?void 0:b.term)?(P=(w=f).push,[4,this.getLicenseeData(b.term.term_id)]):[3,4]):[3,5];case 3:P.apply(w,[c.sent()]),c.label=4;case 4:return v++,[3,2];case 5:return y=Array.from(new Set(f.map((function(e){return null==e?void 0:e.id})))).join("|")||void 0,C=Array.from(new Set(f.map((function(e){return null==e?void 0:e.name})))).join("|")||void 0,[2,{accessGrantedStatus:null!==(r=null===(i=s[0])||void 0===i?void 0:i.user_access.granted)&&void 0!==r&&r,accountTermType:p,resourceName:d,termName:g,orgId:y,orgName:C,userType:h}]}}))}))},setReportingForAuthUser:function(e){var n=e.uid;return a(this,void 0,void 0,(function(){var e,t,i,r;return c(this,(function(s){switch(s.label){case 0:e=this,t={};try{t=JSON.parse(window.pmc.cookie.get("pmc_piano_reporting")||null)||{}}catch(n){e.canDebug&&console.log("PMC: Piano: No reporting cookie",n.toString())}return(null==t?void 0:t.acct_id)===n?[2,Promise.resolve()]:[4,this.getReportingForAuthUser()];case 1:return i=s.sent(),r={acct_id:n,acct_type:i.accountTermType,entitlements:i.resourceName,paywall_logged_in:i.accessGrantedStatus,user_type:i.userType,org_id:i.orgId||null,org_name:i.orgName||null},this.reporting=o(o({},e.reporting),r),this.setReportingCookie(),[2,Promise.resolve()]}}))}))},importWpApiFetch:function(){return a(void 0,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve().then((function(){return s(t(989))}))];case 1:return[2,e.sent()]}}))}))},getFromEndpoint:function(e){return a(this,void 0,void 0,(function(){var n,t;return c(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,this.importWpApiFetch()];case 1:return[4,(0,o.sent().default)({url:"https://".concat(window.location.host).concat(e)})];case 2:return n=o.sent(),this.canDebug&&console.log("PMC: Piano: Rest API Response",e,n),[2,n];case 3:return t=o.sent(),this.canDebug&&console.warn("PMC: Piano: Could not retrieve data from WordPress Rest API",n,t),[3,4];case 4:return[2,{}]}}))}))},getUserCustomFields:function(){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2,this.getFromEndpoint("".concat(this.userCustomFieldsEndpoint,"/").concat(this.user.uid))]}))}))},getLicenseeData:function(e){return a(this,void 0,void 0,(function(){return c(this,(function(n){return[2,this.getFromEndpoint("".concat(this.licenseeEndpoint,"/").concat(e))]}))}))},getAuthUserType:function(e){void 0===e&&(e={});var n=null==e?void 0:e.user_access,t=null==e?void 0:e.term,o=null==t?void 0:t.resource;return(null==o?void 0:o.name)&&""!==o.name?(null==n?void 0:n.granted)&&(/registration/i.exec(null==t?void 0:t.name)||"registration"===(null==t?void 0:t.type))?"REGISTERED":(null==n?void 0:n.granted)?"SUBSCRIBER":void 0:"KNOWN"},getAccountType:function(e){return["email_domain_contract","specific_email_addresses_contract"].includes(e)?"site_license":"individual"},setReportingCookie:function(){this.canDebug&&console.log("PMC: Piano: Setting pmc_piano_reporting cookie",this.reporting),window.pmcPianoCookie.setReportingCookie(JSON.stringify(this.reporting))},deleteReportingCookie:function(){this.canDebug&&console.log("PMC: Piano: Deleting pmc_piano_reporting cookie",this.reporting),window.pmcPianoCookie.deleteReportingCookie()},registerOnLoggedInUserCallback:function(e){this.initialized&&this.hasUser()&&e(this.getUser()),this.onLoggedInUserCallbacks.push(e)},registerOnLoggedOutUserCallback:function(e){this.onLoggedOutUserCallbacks.push(e)},registerOnPageLoadNotHasUserCallback:function(e){this.initialized&&!this.hasUser()&&e(),this.onPageLoadNotHasUserCallbacks.push(e)},registerOnHasIPUserCallback:function(e){this.initialized&&!0===this.hasIPUser()&&e(),this.onHasIPUserCallbacks.push(e)},triggerOnLoggedInUserCallbacks:function(){var e=this;e.canDebug&&console.log("PMC: Piano: Running login callbacks",e.onLoggedInUserCallbacks),e.onLoggedInUserCallbacks.forEach((function(n){n(e.user)}))},triggerOnLoggedOutUserCallbacks:function(){var e=this;e.canDebug&&console.log("PMC: Piano: Running logout callbacks",e.onLoggedOutUserCallbacks),e.onLoggedOutUserCallbacks.forEach((function(e){e()}))},triggerOnPageLoadNotHasUserCallbacks:function(){var e=this;e.canDebug&&console.log("PMC: Piano: Running no-user callbacks",e.onPageLoadNotHasUserCallbacks),e.onPageLoadNotHasUserCallbacks.forEach((function(e){e()}))},triggerOnHasIPUserCallbacks:function(){var e=this;e.canDebug&&console.log("PMC: Piano: Running has-IP-user callbacks",e.onHasIPUserCallbacks),e.onHasIPUserCallbacks.forEach((function(e){e()}))},setIPUser:function(){var e=u;e.canDebug&&console.log("PMC: Piano: IP Match"),e.isIPUser=!0,e.reporting.acct_type="ip",e.reporting.user_type="KNOWN",e.setReportingCookie(),e.triggerOnHasIPUserCallbacks()},maybeRenderMyAccountPage:function(){document.querySelector(this.myAccountPageSelector)&&window.tp.myaccount.show({displayMode:"inline",containerSelector:this.myAccountPageSelector})},maybeRenderPasswordResetPage:function(){if(!document.querySelector(this.passwordResetPageSelector))return"password reset element missing";var e=window.location.search.match(/reset_token=([A-Za-z0-9]+)/);return e?(window.onmessage=this.redirectHomeOnClosedMessage,window.tp.pianoId.show({resetPasswordToken:e[1],loggedIn:function(){window.location="/"}})):"invalid token"},redirectHomeOnClosedMessage:function(e){if("string"==typeof e.data){var n=JSON.parse(e.data);n.sender&&n.sender.startsWith("piano-id")&&"closed"===n.event&&(window.location="/")}},reRenderExperiences:function(){var e=this,n=window.tp;e.canDebug&&console.log("PMC: Piano: Re-rendering Experiences"),n.offer.closeInline(e.pianoPaywallSelector),n.offer.closeInline("#piano-right-rail"),n.offer.closeInline("#piano-mid-river"),n.offer.closeInline("#piano-sticky-footer"),n.offer.closeInline("#piano-fly-out");var t=document.querySelector(e.pmcPaywallSelector);t&&t.classList.remove(e.truncatedContentSelector),n.experience.execute()}};u.checkTp(),e.exports=u},989:e=>{"use strict";e.exports=window.wp.apiFetch}},n={},t=function t(o){var i=n[o];if(void 0!==i)return i.exports;var r=n[o]={exports:{}};return e[o].call(r.exports,r,r.exports,t),r.exports}(13);(pmcPiano=void 0===pmcPiano?{}:pmcPiano).piano=t})();